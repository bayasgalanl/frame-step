<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; media-src 'self' file:; img-src 'self' data: file:;">
  <title>FrameStep</title>
  <link rel="stylesheet" href="styles/main.css">
</head>

<body>
  <div class="app-container">
    <!-- VS Code style titlebar -->
    <div class="titlebar">
      <!-- Hamburger menu -->
      <div class="menu-container">
        <button class="titlebar-btn" id="menuToggle" title="Menu">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </button>
        <div class="titlebar-menus" id="titlebarMenus">
          <div class="menu-item" id="menuFile">
            <span class="menu-label">File</span>
            <div class="menu-dropdown">
              <div class="menu-option" id="menuOpen">
                <span>Open Video</span>
                <span class="shortcut">O</span>
              </div>
            </div>
          </div>
          <div class="menu-item" id="menuView">
            <span class="menu-label">View</span>
            <div class="menu-dropdown">
              <div class="menu-option" id="menuFullscreen">
                <span>Toggle Fullscreen</span>
                <span class="shortcut">F</span>
              </div>
            </div>
          </div>
          <div class="menu-item" id="menuHelp">
            <span class="menu-label">Help</span>
            <div class="menu-dropdown">
              <div class="menu-option" id="menuShortcuts">
                <span>Keyboard Shortcuts</span>
                <span class="shortcut">?</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Window title (centered) -->
      <div class="titlebar-title" id="titlebarTitle">FrameStep</div>

      <!-- Window controls -->
      <div class="titlebar-controls">
        <button class="titlebar-btn" id="minimizeBtn" title="Minimize">
          <svg width="10" height="10" viewBox="0 0 10 10">
            <rect fill="currentColor" width="10" height="1" y="4.5" />
          </svg>
        </button>
        <button class="titlebar-btn" id="maximizeBtn" title="Maximize">
          <svg class="maximize-icon" width="10" height="10" viewBox="0 0 10 10">
            <rect fill="none" stroke="currentColor" stroke-width="1" x="0.5" y="0.5" width="9" height="9" />
          </svg>
          <svg class="restore-icon" width="10" height="10" viewBox="0 0 10 10" style="display: none;">
            <path fill="none" stroke="currentColor" stroke-width="1" d="M3.5 3.5V0.5h6v6h-3" />
            <rect fill="none" stroke="currentColor" stroke-width="1" x="0.5" y="3.5" width="6" height="6" />
          </svg>
        </button>
        <button class="titlebar-btn titlebar-btn-close" id="closeBtn" title="Close">
          <svg width="10" height="10" viewBox="0 0 10 10">
            <path fill="currentColor"
              d="M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Main video area -->
    <div class="video-container" id="videoContainer">
      <!-- Video element for playback -->
      <video id="videoElement" preload="auto"></video>

      <!-- Canvas for frame-accurate display -->
      <canvas id="frameCanvas"></canvas>

      <!-- Drop zone overlay -->
      <div class="drop-zone" id="dropZone">
        <div class="drop-zone-content">
          <svg class="drop-icon" viewBox="0 0 24 24" width="64" height="64">
            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
          <p>Drop video file here</p>
          <p class="drop-hint">or press <kbd>O</kbd> to open</p>
        </div>
      </div>

      <!-- Frame overlay (top-left) -->
      <div class="frame-overlay" id="frameOverlay">
        <span class="frame-number" id="frameNumber">Frame: 0</span>
        <span class="frame-separator">/</span>
        <span class="total-frames" id="totalFrames">0</span>
        <span class="timestamp" id="timestamp">00:00:00.000</span>
      </div>

      <!-- VFR Warning -->
      <div class="vfr-warning" id="vfrWarning">
        <svg viewBox="0 0 24 24" width="16" height="16">
          <path fill="currentColor"
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
        </svg>
        <span>Variable frame rate detected</span>
      </div>

      <!-- Loading indicator -->
      <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
      </div>

      <!-- Playback feedback (center) -->
      <div class="playback-feedback" id="playbackFeedback">
        <div class="feedback-icon play-feedback" id="playFeedback">
          <svg viewBox="0 0 24 24" width="60" height="60">
            <path fill="currentColor" d="M8 5v14l11-7z" />
          </svg>
        </div>
        <div class="feedback-icon pause-feedback" id="pauseFeedback">
          <svg viewBox="0 0 24 24" width="60" height="60">
            <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
          </svg>
        </div>
      </div>
    </div>

    <!-- Controls bar -->
    <div class="controls-bar" id="controlsBar">
      <!-- Timeline (Top row) -->
      <div class="timeline-container">
        <div class="timeline" id="timeline">
          <div class="timeline-progress" id="timelineProgress">
            <div class="timeline-thumb"></div>
          </div>
        </div>
      </div>

      <!-- Main Controls Row -->
      <div class="controls-main">
        <!-- Left controls -->
        <div class="controls-left">
          <button class="control-btn" id="restartBtn" title="Restart (R)" disabled>
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor"
                d="M12 4V1l5 5-5 5V8c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8V4z" />
            </svg>
          </button>

          <button class="control-btn" id="playPauseBtn" title="Play/Pause (Space)" disabled>
            <svg class="play-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M8 5v14l11-7z" />
            </svg>
            <svg class="pause-icon" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
              <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
            </svg>
          </button>

          <div class="volume-container">
            <button class="control-btn" id="muteBtn" title="Mute (M)">
              <svg class="volume-up-icon" viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor"
                  d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
              </svg>
              <svg class="volume-off-icon" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
                <path fill="currentColor"
                  d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
              </svg>
            </button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" title="Volume">
          </div>
        </div>

        <!-- Right controls -->
        <div class="controls-right">
          <button class="control-btn frame-btn" id="prevFrameBtn" title="Previous frame (←)" disabled>
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
            </svg>
          </button>

          <button class="control-btn frame-btn" id="nextFrameBtn" title="Next frame (→)" disabled>
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
            </svg>
          </button>

          <span class="time-display" id="timeDisplay">00:00 / 00:00</span>

          <button class="control-btn" id="fullscreenBtn" title="Enter fullscreen (F)">
            <svg class="fullscreen-enter-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor"
                d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
            </svg>
            <svg class="fullscreen-exit-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor"
                d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z" />
            </svg>
          </button>
        </div>
      </div>
    </div>


    <!-- Keyboard shortcuts help -->
    <div class="shortcuts-help" id="shortcutsHelp">
      <div class="shortcut"><kbd>Space</kbd> Play/Pause</div>
      <div class="shortcut"><kbd>←</kbd><kbd>→</kbd> ±1 Frame</div>
      <div class="shortcut"><kbd>Shift</kbd>+<kbd>←</kbd><kbd>→</kbd> ±10 Frames</div>
      <div class="shortcut"><kbd>Scroll</kbd> Scrub frames</div>
      <div class="shortcut"><kbd>O</kbd> Open file</div>
      <div class="shortcut"><kbd>F</kbd> Toggle Fullscreen</div>
      <div class="shortcut"><kbd>M</kbd> Mute/Unmute</div>
      <div class="shortcut"><kbd>R</kbd> Restart</div>
      <div class="shortcut"><kbd>0</kbd>-<kbd>9</kbd> Seek 0-90%</div>
      <div class="shortcut"><kbd>?</kbd> Toggle help</div>
    </div>
  </div>

  <script src="js/frame-cache.js"></script>
  <script src="js/ui-overlay.js"></script>
  <script src="js/video-controller.js"></script>
  <script src="js/controls.js"></script>
  <script src="js/app.js"></script>
</body>

</html>
