<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; media-src 'self' file:; img-src 'self' data: file:;">
  <title>FrameStep</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="app-container">
    <!-- VS Code style titlebar -->
    <div class="titlebar">
      <!-- Menu items -->
      <div class="titlebar-menus">
        <div class="menu-item" id="menuFile">
          <span class="menu-label">File</span>
          <div class="menu-dropdown">
            <div class="menu-option" id="menuOpen">
              <span>Open Video</span>
              <span class="shortcut">Ctrl+O</span>
            </div>
            <div class="menu-separator"></div>
            <div class="menu-option" id="menuExit">
              <span>Exit</span>
              <span class="shortcut">Alt+F4</span>
            </div>
          </div>
        </div>
        <div class="menu-item" id="menuView">
          <span class="menu-label">View</span>
          <div class="menu-dropdown">
            <div class="menu-option" id="menuFullscreen">
              <span>Toggle Fullscreen</span>
              <span class="shortcut">F11</span>
            </div>
            <div class="menu-option" id="menuDevTools">
              <span>Developer Tools</span>
              <span class="shortcut">Ctrl+Shift+I</span>
            </div>
          </div>
        </div>
        <div class="menu-item" id="menuHelp">
          <span class="menu-label">Help</span>
          <div class="menu-dropdown">
            <div class="menu-option" id="menuShortcuts">
              <span>Keyboard Shortcuts</span>
              <span class="shortcut">?</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Window title (centered) -->
      <div class="titlebar-title" id="titlebarTitle">FrameStep</div>

      <!-- Window controls -->
      <div class="titlebar-controls">
        <button class="titlebar-btn" id="minimizeBtn" title="Minimize">
          <svg width="10" height="10" viewBox="0 0 10 10">
            <rect fill="currentColor" width="10" height="1" y="4.5"/>
          </svg>
        </button>
        <button class="titlebar-btn" id="maximizeBtn" title="Maximize">
          <svg class="maximize-icon" width="10" height="10" viewBox="0 0 10 10">
            <rect fill="none" stroke="currentColor" stroke-width="1" x="0.5" y="0.5" width="9" height="9"/>
          </svg>
          <svg class="restore-icon" width="10" height="10" viewBox="0 0 10 10" style="display: none;">
            <rect fill="none" stroke="currentColor" stroke-width="1" x="2.5" y="0.5" width="7" height="7"/>
            <polyline fill="none" stroke="currentColor" stroke-width="1" points="0.5,2.5 0.5,9.5 7.5,9.5 7.5,2.5"/>
          </svg>
        </button>
        <button class="titlebar-btn titlebar-btn-close" id="closeBtn" title="Close">
          <svg width="10" height="10" viewBox="0 0 10 10">
            <path fill="currentColor" d="M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Main video area -->
    <div class="video-container" id="videoContainer">
      <!-- Video element for playback -->
      <video id="videoElement" preload="auto"></video>
      
      <!-- Canvas for frame-accurate display -->
      <canvas id="frameCanvas"></canvas>
      
      <!-- Drop zone overlay -->
      <div class="drop-zone" id="dropZone">
        <div class="drop-zone-content">
          <svg class="drop-icon" viewBox="0 0 24 24" width="64" height="64">
            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
          <p>Drop video file here</p>
          <p class="drop-hint">or press <kbd>O</kbd> to open</p>
        </div>
      </div>

      <!-- Frame overlay (top-left) -->
      <div class="frame-overlay" id="frameOverlay">
        <span class="frame-number" id="frameNumber">Frame: 0</span>
        <span class="frame-separator">/</span>
        <span class="total-frames" id="totalFrames">0</span>
        <span class="timestamp" id="timestamp">00:00:00.000</span>
      </div>

      <!-- VFR Warning -->
      <div class="vfr-warning" id="vfrWarning">
        <svg viewBox="0 0 24 24" width="16" height="16">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <span>Variable frame rate detected</span>
      </div>

      <!-- Loading indicator -->
      <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- Controls bar -->
    <div class="controls-bar" id="controlsBar">
      <!-- Left controls -->
      <div class="controls-left">
        <button class="control-btn" id="openBtn" title="Open file (O)">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M19 4H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H5V8h14v12z"/>
          </svg>
        </button>
        
        <button class="control-btn" id="playPauseBtn" title="Play/Pause (Space)" disabled>
          <svg class="play-icon" viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M8 5v14l11-7z"/>
          </svg>
          <svg class="pause-icon" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
            <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
      </div>

      <!-- Timeline -->
      <div class="timeline-container">
        <div class="timeline" id="timeline">
          <div class="timeline-progress" id="timelineProgress">
            <div class="timeline-thumb"></div>
          </div>
        </div>
      </div>

      <!-- Right controls -->
      <div class="controls-right">
        <button class="control-btn frame-btn" id="prevFrameBtn" title="Previous frame (←)" disabled>
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
          </svg>
        </button>
        
        <button class="control-btn frame-btn" id="nextFrameBtn" title="Next frame (→)" disabled>
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
          </svg>
        </button>

        <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
      </div>
    </div>

    <!-- Keyboard shortcuts help -->
    <div class="shortcuts-help" id="shortcutsHelp">
      <div class="shortcut"><kbd>Space</kbd> Play/Pause</div>
      <div class="shortcut"><kbd>←</kbd><kbd>→</kbd> ±1 Frame</div>
      <div class="shortcut"><kbd>Shift</kbd>+<kbd>←</kbd><kbd>→</kbd> ±10 Frames</div>
      <div class="shortcut"><kbd>Scroll</kbd> Scrub frames</div>
      <div class="shortcut"><kbd>O</kbd> Open file</div>
      <div class="shortcut"><kbd>?</kbd> Toggle help</div>
    </div>
  </div>

  <script src="js/frame-cache.js"></script>
  <script src="js/ui-overlay.js"></script>
  <script src="js/video-controller.js"></script>
  <script src="js/controls.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
